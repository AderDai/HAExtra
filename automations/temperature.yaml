# 主卧温度高
- alias: Bedroom Temperature High
  trigger:
    - platform: numeric_state
      entity_id: climate.daikin3
      value_template: '{{ state.attributes.current_temperature }}'
      above: 28
      for:
        minutes: 10
  condition:
    - condition: time
      after: '20:00'
      before: '08:00'
  action:
    - service: climate.turn_on
      entity_id: climate.daikin3

# 主卧温度低
- alias: Bedroom Temperature Low
  trigger:
    - platform: numeric_state
      entity_id: climate.daikin3
      value_template: '{{ state.attributes.current_temperature }}'
      below: 25
      for:
        minutes: 10
  action:
    - service: climate.turn_off
      entity_id: climate.daikin3

# 儿童房温度高
- alias: Kids Temperature High
  trigger:
    - platform: numeric_state
      entity_id: climate.daikin4
      value_template: '{{ state.attributes.current_temperature }}'
      above: 28
      for:
        minutes: 10
  condition:
    - condition: time
      after: '20:00'
      before: '08:00'
  action:
    - service: climate.turn_on
      entity_id: climate.daikin4

# 儿童房温度低
- alias: Kids Temperature Low
  trigger:
    - platform: numeric_state
      entity_id: climate.daikin4
      value_template: '{{ state.attributes.current_temperature }}'
      below: 25
      for:
        minutes: 10
  action:
    - service: climate.turn_off
      entity_id: climate.daikin4

# 儿童房风扇温度变化
- alias: Fan Temperature Changed
  trigger:
    - platform: time
      at: '20:00:01'
    - platform: numeric_state
      entity_id: fan.fan
      value_template: '{{ state.attributes.temperature }}'
      above: 31 # 升至高档
      for:
        minutes: 5
    - platform: numeric_state
      entity_id: fan.fan
      value_template: '{{ state.attributes.temperature }}'
      above: 29 # 升至中档
      for:
        minutes: 4
    - platform: numeric_state
      entity_id: fan.fan
      value_template: '{{ state.attributes.temperature }}'
      above: 27 # 升至低档
      for:
        minutes: 6
    - platform: numeric_state
      entity_id: fan.fan
      value_template: '{{ state.attributes.temperature }}'
      below: 30 # 降至中档
      for:
        minutes: 5
    - platform: numeric_state
      entity_id: fan.fan
      value_template: '{{ state.attributes.temperature }}'
      below: 28 # 降至低档
      for:
        minutes: 4
    - platform: numeric_state
      entity_id: fan.fan
      value_template: '{{ state.attributes.temperature }}'
      below: 25 # 降至关机
      for:
        minutes: 6
  condition:
    - condition: time
      after: '20:00'
      before: '08:00'
  action:
    - service_template: '{% if (state_attr("fan.fan", "temperature") | int > 25) %}fan.turn_on{% else %}fan.turn_off{% endif %}'
      entity_id: fan.fan
    - condition: numeric_state
      entity_id: fan.fan
      value_template: '{{ state.attributes.temperature }}'
      above: 25
    - service: fan.set_speed
      data_template:
        entity_id: fan.fan
        speed: '{% if (state_attr("fan.fan", "temperature") | int > 31) %}Level 3{% elif (state_attr("fan.fan", "temperature") | int > 29) %}Level 2{% else %}Level 1{% endif %}'
    - delay: 1
    - service: logbook.log
      data_template:
        name: '{{ state_attr("fan.fan", "friendly_name") }}={{ state_attr("fan.fan", "temperature") }}'
        message: '{{ state_attr("fan.fan", "friendly_name") }}⇒{{ state_attr("fan.fan", "speed") }}'

# 书房风扇温度变化
- alias: Fan2 Temperature Changed
  trigger:
    - platform: time
      at: '20:00:01'
    - platform: numeric_state
      entity_id: fan.fan2
      value_template: '{{ state.attributes.temperature }}'
      above: 31 # 升至高档
      for:
        minutes: 5
    - platform: numeric_state
      entity_id: fan.fan2
      value_template: '{{ state.attributes.temperature }}'
      above: 29 # 升至中档
      for:
        minutes: 4
    - platform: numeric_state
      entity_id: fan.fan2
      value_template: '{{ state.attributes.temperature }}'
      above: 27 # 升至低档
      for:
        minutes: 6
    - platform: numeric_state
      entity_id: fan.fan2
      value_template: '{{ state.attributes.temperature }}'
      below: 30 # 降至中档
      for:
        minutes: 5
    - platform: numeric_state
      entity_id: fan.fan2
      value_template: '{{ state.attributes.temperature }}'
      below: 28 # 降至低档
      for:
        minutes: 4
    - platform: numeric_state
      entity_id: fan.fan2
      value_template: '{{ state.attributes.temperature }}'
      below: 25 # 降至关机
      for:
        minutes: 6
  condition:
    - condition: time
      after: '20:00'
      before: '08:00'
  action:
    - service_template: '{% if (state_attr("fan.fan2", "temperature") | int > 25) %}fan.turn_on{% else %}fan.turn_off{% endif %}'
      entity_id: fan.fan2
    - condition: numeric_state
      entity_id: fan.fan2
      value_template: '{{ state.attributes.temperature }}'
      above: 25
    - service: fan.set_speed
      data_template:
        entity_id: fan.fan2
        speed: '{% if (state_attr("fan.fan2", "temperature") | int > 31) %}Level 3{% elif (state_attr("fan.fan2", "temperature") | int > 29) %}Level 2{% else %}Level 1{% endif %}'
    - delay: 1
    - service: logbook.log
      data_template:
        name: '{{ state_attr("fan.fan2", "friendly_name") }}={{ state_attr("fan.fan2", "temperature") }}'
        message: '{{ state_attr("fan.fan2", "friendly_name") }}⇒{{ state_attr("fan.fan2", "speed") }}'
